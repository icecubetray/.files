export PROMPT_COMMAND=__prompt_command;
__prompt_command() {
	EXITCODE=$?;
	COLOR_EXITCODE="";

	if [ $EXITCODE != 0 ]; then
		COLOR_EXITCODE="\[\e[31;1m\]";
	else
		COLOR_EXITCODE="\[\e[32m\]";
	fi

	PS1="\[\e[0m\][$COLOR_EXITCODE`printf %3s $EXITCODE`\[\e[0m\]] ";

	COLOR_RESET="\[\e[0m\]"
	COLOR_HOST="\[\e[35;1m\]"
	COLOR_CWD="\[\e[37;1m\]"
	COLOR_USER="";
	COLOR_GIT="\[\e[37;2m\]";
	COLOR_GIT_BRANCH="\[\e[31m\]";
	COLOR_GIT_COMMIT=$COLOR_GIT;
	COLOR_GIT_DATE=$COLOR_GIT;
	COLOR_GIT_UNSTAGED="\[\e[31m\]";
	COLOR_GIT_STAGED="\[\e[32m\]";
	COLOR_SUFFIX="\[\e[36m\]";

	SUFFIX="";

	if [ $(id -u) != 0 ]; then
		COLOR_USER="\[\e[34;1m\]";
		SUFFIX="\$";
	else
		COLOR_USER="\[\e[31;1m\]";
		SUFFIX="#";
	fi
	SUFFIX=" $COLOR_SUFFIX$SUFFIX$COLOR_RESET ";

	PS1+="$COLOR_USER\u$COLOR_RESET@$COLOR_HOST\h$COLOR_RESET:$COLOR_CWD\w$COLOR_RESET";

	if [ "$GIT_PROMPT" == "1" ]; then
		GIT_BRANCH=$(git rev-parse --abbrev-ref HEAD 2> /dev/null);
		if [ $? == 0 ]; then
			if [ -n "$GIT_BRANCH" ]; then
				git update-index -q --ignore-submodules --refresh;

				DIFF_FILES=$(git diff-files --ignore-submodules -- 2> /dev/null | wc -l 2> /dev/null);
				if [ -z "$DIFF_FILES" ]; then
					DIFF_FILES="0";
				fi

				DIFF_INDEX=$(git diff-index --ignore-submodules --cached --name-only HEAD -- 2> /dev/null | wc -l 2> /dev/null);
				if [ -z "$DIFF_INDEX" ]; then
					DIFF_INDEX="0";
				fi

				if ([ $DIFF_FILES != "0" ] || [ $DIFF_INDEX != "0" ]); then
					COLOR_GIT_BRANCH="\[\e[33m\]";

					if [ $DIFF_FILES != "0" ]; then
						DIFF_FILES=" $COLOR_RESET$COLOR_GIT_UNSTAGED$DIFF_FILES unstaged";
					else
						DIFF_FILES="";
					fi

					if [ $DIFF_INDEX != "0" ]; then
						DIFF_INDEX=" $COLOR_RESET$COLOR_GIT_STAGED$DIFF_INDEX staged";
					else
						DIFF_INDEX="";
					fi
				else
					COLOR_GIT_BRANCH="\[\e[32m\]";
					DIFF_FILES="";
					DIFF_INDEX="";
				fi

				GIT_COMMIT=$(git log -n 1 --format="$COLOR_RESET$COLOR_GIT_COMMIT%h $COLOR_RESET$COLOR_GIT_DATE%ai");

				PS1="\n$PS1 $COLOR_GIT($GIT_COMMIT $COLOR_RESET$COLOR_GIT_BRANCH$GIT_BRANCH$COLOR_RESET$DIFF_FILES$DIFF_INDEX$COLOR_GIT)$COLOR_RESET\ngit repo$SUFFIX";
				return 0;
			fi
		fi
	fi

	PS1+=$SUFFIX;
}
